<%= simple_form_for @actividad, 
  :url => cor1440_gen.actividades_path(@actividad).sub(/\./,"/"), 
  :html => { :class => 'form-horizontal' } do |f| 
%>
<div data-role="content" class="form-inputs">
  <div id="errores">
    <% if f.object.errors.any? %>
      <div id="error_explanation">
        <div class="alert alert-error">
          El formulario tiene 
          <%= pluralize(f.object.errors.count, "error") %>.
        </div>
        <ul>
          <% f.object.errors.full_messages.each do |msg| %>
            <li>* <%= msg %></li>
          <% end %>
        </ul>
      </div>
    <% end %>
    <%= f.error_notification %>
  </div>

  <div class="panel panel-default">
    <div class="panel-heading">Planeación</div><div class="panel-body">
      <%= f.input :nombre,
        label: 'Nombre / Escenario de toma de decisión / Acción Colectiva'
      %>
      <%= f.input :fecha_localizada, 
        :input_html => { "data-behaviour" => "datepicker"}, 
        :as => :string
      %>
      <%= f.input :duracion, 
        label: 'Duración estimada',
        as: :integer
       %>
      <%= f.input(:mduracion, collection: [
                  "Minutos",
                  "Horas",
                  "Días",
                  "Meses"
        ], 
        label: 'Unidad de duración',
        input_html: { class: 'chosen-select' }
        ) 
      %>
      <%= f.association :departamento,
        collection: (Sip::Departamento.where(
          id_pais: 170,
          fechadeshabilitacion: nil).order(:nombre)),
          label: "Departamento",
          label_method: :nombre,
          value_method: :id,
          input_html: { class: 'chosen-select' }
      %>
      <%= f.association :municipio,
        collection: (Sip::Municipio.where(
          id_departamento: f.object.departamento_id,
          fechadeshabilitacion: nil).order(:nombre)),
          label: "Municipio",
          label_method: :nombre,
          value_method: :id#,
      #input_html: { class: 'chosen-select' } --debe actualizarse chosen
      # cuando departamento se actualiza
      %>
      <%= f.input :lugar,
        label: 'Lugar'
      %>
      <!--%= f.input :duracion %-->
      <%= f.input :oficina_id, as: :hidden, value: 101 %>
      <!--%= f.association :oficina,
        collection: Sip::Oficina.habilitados,
        label_method: :nombre, 
        value_method: :id,
        include_blank: false
        %-->
        <%= f.association :responsable,
          collection: Usuario.all.order(:nombres, :apellidos, :nusuario),
          include_blank: false,
          label: "Responsable del equipo",
          label_method: lambda { |t| 
            r = ""
            r += t.nombres + " " if t.nombres
            r += t.apellidos if t.apellidos
            r += ' -  ' + t.nusuario
            r 
          },
          value_method: :id,
          selected:  f.object.usuario_id ? f.object.usuario_id : current_usuario.id,
          input_html: { class: 'chosen-select' } %>

        <%= f.association :usuario,
          collection: Usuario.where(fechadeshabilitacion: nil).order(:nombres, :apellidos, :nusuario),
          include_blank: false,
          label: "Corresponsables del equipo",
          label_method: lambda { |t| 
            r = ""
            r += t.nombres + " " if t.nombres
            r += t.apellidos if t.apellidos
            r += ' -  ' + t.nusuario
            r 
          },
          value_method: :id,
          input_html: { class: 'chosen-select' }
      %>
      <!-- incluido en actividadtipo %= f.input :papel,
        label: 'Papel en la Actividad'
      %-->
      <%= f.association :actividadtipo, 
        collection: Cor1440Gen::Actividadtipo.habilitados,
        label_method: :nombre, 
        value_method: :id,
        input_html: { class: 'chosen-select' }
      %>
      <%= f.association :proyectofinanciero,
        collection: Cor1440Gen::Proyectofinanciero.habilitados.
          order(:referenciacinep),
        label_method: :referenciacinep, 
        value_method: :id,
        input_html: { class: 'chosen-select' }
      %>
      <%= f.association :proyecto,
        collection: Cor1440Gen::Proyecto.habilitados,
        label: 'Programa/Servicio/Producto',
        label_method: :nombre, 
        value_method: :id,
        input_html: { class: 'chosen-select' }
      %>
      <%= f.input :objetivo, as: :text %>
    
      <%= f.input(:convocante, collection: [
                  "COMPAÑIA DE JESÚS",
                  "EL BANCO DE DATOS",
                  "EL CINEP/PPP",
                  "ENTIDAD ESTATAL",
                  "ONG",
                  "OTRO",
                  "SISTEMA ONU",
                  "UNA AGENCIA FINANCIADORA"
        ], 
        label: '¿Quién convocó la actividad?',
        include_blank: false,
        input_html: { class: 'chosen-select' }) 
      %>

    </div> <!-- panel-body -->
  </div> <!-- panel panel-default -->
  <div class="panel panel-default">
    <div class="panel-heading">Plan Trienal CINEP</div><div class="panel-body">
      <!--%= f.association :actividadareas, 
        collection: Cor1440Gen::Actividadarea.habilitados,
        label_method: :nombre, 
        value_method: :id 
        %-->
      <%= f.association :actor, 
        collection: ::Actor.habilitados.where.not(id: 102).where.not(id: 103),
        label: "Otros actores sociales/institucionales acompañados o que participan",
        label_method: :nombre, 
        value_method: :id,
        input_html: { class: 'chosen-select' }
      %>
      <%= f.association :nucleoconflicto, 
        collection: ::Nucleoconflicto.habilitados,
        label_method: :nombre, 
        value_method: :id,
        label: 'Principal núcleo de conflico que transforma',
        input_html: { class: 'chosen-select' }
      %>
      <%= f.association :otronucleoconflicto, 
        collection: ::Nucleoconflicto.habilitados,
        label: "Otros núcleos de conflico que transforma",
        label_method: :nombre, 
        value_method: :id,
        input_html: { class: 'chosen-select' }
      %>
      <div class="panel panel-default">
        <div class="panel-heading">Objetivo Específico 1. Participación en Escenarios de Toma de Decisión con Publicaciones CINEP</div>
        <div class="panel-body">
          <%= f.association :publicacion, 
            collection: ::Publicacion.habilitados,
            label: "Publicaciones/Insumos CINEP usados en Escenario de Toma de Decisión",
            label_method: :nombre, 
            value_method: :id,
            input_html: { class: 'chosen-select' }
          %>
          <%= f.association :redactor, 
            collection: ::Redactor.habilitados,
            label_method: :nombre, 
            value_method: :id,
            label: 'Red de Actores a la que se víncula Escenario de Toma de Decisión',
            input_html: { class: 'chosen-select' }
          %>
          <%= f.input(:alcance, collection: [ "Local",
                      "Regional",
                      "Nacional",
                      "Internacional"
          ], 
            label: 'Alcance',
            input_html: { class: 'chosen-select' },
            include_blank: false ) 
          %>
        </div>
      </div>
      <div class="panel panel-default">
        <div class="panel-heading">Objetivo Específico 2.  Acompañamiento a Actores Sociales en Acciones Colectivas e Incidencia</div>
        <div class="panel-body">
          <%= f.input :accionincidencia, 
            boolean_style: :nested,
            inline_label: '¿Incide en Transformación de Nucleos de Conflicto?'
          %>
          <%= f.input :accioncgenero, 
            boolean_style: :nested,
            inline_label: '¿Acción Colectiva vinculada a Derechos de Género?'
          %>
          <%= f.input :accioncetnia, 
            boolean_style: :nested,
            inline_label: '¿Acción Colectiva vinculada a Derecho de Étnia?'
          %>
        </div>
      </div>

    </div> <!-- panel-body -->
  </div> <!-- panel panel-default -->
  <div class="panel panel-default">
    <div class="panel-heading">Desarrollo</div><div class="panel-body">
      <%= f.input :participantes,
        label: 'Personas acompañadas o que participan',
        as: :text
      %>
      <!--%= f.input :totorg, label: 'Total organizaciones' %-->
      <%= f.input :mujeres,
        label: 'Mujeres'
      %>
      <%= f.input :hombres,
        label: 'Hombres'
      %>
      <%= f.input :negros,
        label: 'Negros'
      %>
      <%= f.input :indigenas,
        label: 'Indigenas'
      %>
      <%= f.input :mestizos,
        label: 'Mestizos'
      %>
      <%= f.input :blancos,
        label: 'Blancos'
      %>
      <%= f.input :desarrollo,
        label: 'Desarrollo de la Actividad',
        as: :text
      %>
    </div> <!-- panel-body -->
  </div> <!-- panel panel-default -->
  <div class="panel panel-default">
    <div class="panel-heading">Evaluación/Seguimiento</div><div class="panel-body">
      <%= f.input :resultado, as: :text %>
      <%= f.input :contexto, as: :text %>
      <%= f.input :observaciones,
        label: 'Compromisos / Observaciones',
        as: :text
      %>
      <%= f.input(:valora, collection: [
                  1,
                  2,
                  3,
                  4,
                  5
        ], 
        input_html: { class: 'chosen-select' },
        label: 'Valore la actividad en términos de importancia, efecto y proyección (1-5)',
        include_blank: true) 
      %>
    </div> <!-- panel-body -->
  </div> <!-- panel panel-default -->
  <div class="panel panel-default">
    <div class="panel-heading">Medios de Verificación / Anexos</div><div class="panel-body">
   
      <div class="anexos-div anexosdiv">
        <%= f.simple_fields_for :actividad_sip_anexo do |a| %>
          <%= render 'actividad_sip_anexo_fields', :f => a %>
        <% end %>
        <div class="links">
          <%= link_to_add_association 'Añadir Anexo', f, 
            :actividad_sip_anexo, :class => 'btn-primary' 
          %>
        </div>
      </div> <!-- anexos-div -->
    </div> <!-- panel-body -->
  </div> <!-- panel panel-default -->
 
  <div class="form-actions">
    <%= f.button :submit, :class => 'btn-primary' %>
    <%= link_to t('.cancel', :default => t("helpers.links.cancel")),
      cor1440_gen.actividades_path, :class => 'btn' 
    %>
  </div>
<% end %>
